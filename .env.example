# =========================
# Core App
# =========================
APP_NAME={{project-name}}
APP_ENV=dev                # dev|stage|prod
APP_HOST=0.0.0.0
APP_PORT=8080
APP_DEBUG=true
APP_SHUTDOWN_GRACE_SECONDS=10

# =========================
# Feature toggles (runtime)
# IMPORTANT:
# - Cargo features decide what gets compiled into the binary.
# - These FEATURE_* decide what gets initialized at runtime.
# =========================
FEATURE_STARTUP_BANNER=true

FEATURE_DB=false
FEATURE_CACHE=true
FEATURE_SEARCH=false
FEATURE_BROKER=false

FEATURE_OPENAPI=false

FEATURE_REQUEST_LOG=true
FEATURE_TRACING=true
FEATURE_OTEL=false

FEATURE_CORS=false
FEATURE_SESSION=false

# =========================
# Logging / Tracing
# =========================
LOG_LEVEL=info             # error|warn|info|debug|trace
LOG_FORMAT=pretty          # pretty|json
LOG_INCLUDE_TARGET=false
LOG_INCLUDE_FILELINE=false

# Allowlist/denylist for request header logging
REQUEST_LOG_HEADERS_ALLOWLIST=user-agent,content-type
REQUEST_LOG_HEADERS_DENYLIST=authorization,cookie,set-cookie,x-api-key

# =========================
# HTTP / Security defaults
# =========================
HTTP_BODY_LIMIT_BYTES=1048576
HTTP_REQUEST_TIMEOUT_SECONDS=15

# =========================
# Database (SeaORM Postgres)
# Only relevant if FEATURE_DB=true AND binary compiled with `db` feature
# =========================
DB_URL=postgres://postgres:postgres@localhost:5432/app
DB_CONNECT_TIMEOUT_SECONDS=5
DB_MAX_CONNECTIONS=20
DB_MIN_CONNECTIONS=1
DB_ACQUIRE_TIMEOUT_SECONDS=5
DB_IDLE_TIMEOUT_SECONDS=300

# =========================
# Cache
# CACHE_BACKEND: none|moka|redis
# - moka = embedded in-process cache (recommended default)
# - redis = Valkey/Redis external cache
# =========================
CACHE_BACKEND=moka
CACHE_TTL_SECONDS=300
CACHE_MAX_ENTRIES=50000

CACHE_REDIS_URL=redis://localhost:6379
CACHE_REDIS_POOL_SIZE=20
CACHE_REDIS_CONNECT_TIMEOUT_SECONDS=3

# =========================
# Search (Meilisearch)
# Only relevant if FEATURE_SEARCH=true AND compiled with `meilisearch` feature
# =========================
MEILI_URL=http://localhost:7700
MEILI_API_KEY=
MEILI_INDEX_PREFIX=app_
MEILI_CONNECT_TIMEOUT_SECONDS=3

# =========================
# Broker / Streaming
# BROKER_BACKEND: none|nats|iggy|fluvio
# Only relevant if FEATURE_BROKER=true AND compiled with the chosen broker feature
# =========================
BROKER_BACKEND=nats

# NATS / JetStream
NATS_URL=nats://localhost:4222
NATS_JETSTREAM=true
NATS_CONNECT_TIMEOUT_SECONDS=3
NATS_REQUEST_TIMEOUT_SECONDS=3

# Optional alt broker configs (only if you implement them)
IGGY_URL=http://localhost:3000
FLUVIO_PROFILE=local

# =========================
# CORS
# - deny-by-default if CORS_ALLOW_ORIGINS empty
# - comma-separated values
# =========================
CORS_ALLOW_ORIGINS=
CORS_ALLOW_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOW_HEADERS=content-type,authorization
CORS_ALLOW_CREDENTIALS=false
CORS_MAX_AGE_SECONDS=600

# =========================
# Sessions (optional)
# SESSION_BACKEND: cookie|redis
# - cookie recommended default for simple APIs
# - redis sessions require cache-redis feature + FEATURE_CACHE=true + CACHE_BACKEND=redis
# =========================
SESSION_BACKEND=cookie
SESSION_SECRET=CHANGE_ME_TO_A_LONG_RANDOM_SECRET
SESSION_COOKIE_NAME=sid
SESSION_COOKIE_SECURE=true
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=lax     # lax|strict|none
SESSION_TTL_SECONDS=86400

# =========================
# OpenTelemetry (OTLP)
# Only relevant if FEATURE_OTEL=true AND compiled with `otel` feature
# =========================
OTEL_SERVICE_NAME={{project-name}}
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
OTEL_EXPORTER_OTLP_PROTOCOL=grpc     # grpc only (http unsupported in this build)
OTEL_EXPORTER_OTLP_HEADERS=
OTEL_TRACES_SAMPLER=parentbased_traceidratio
OTEL_TRACES_SAMPLER_ARG=0.1
OTEL_RESOURCE_ATTRIBUTES=deployment.environment=dev,service.version=0.1.0
OTEL_METRICS_EXPORT_INTERVAL_SECONDS=10

# =========================
# Banner controls (recommended keep false)
# =========================
BANNER_SHOW_SECRETS=false
BANNER_SHOW_ENV_VARS=false
BANNER_ENV_ALLOWLIST=APP_ENV,APP_DEBUG,FEATURE_DB,FEATURE_CACHE,FEATURE_BROKER,FEATURE_OTEL
